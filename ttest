using Libc

# Fork process
pid = ccall(:fork, Cint, ())
if pid != 0
    println("Child process detached with pid $pid")
    exit(0)
end

# Save original stdio file descriptors
old_stdin = stdin
old_stdout = stdout
old_stderr = stderr

# Redirect stdio
redirect_stdio(stdin=open("/dev/null", "r"),
               stdout=open("/tmp/dmn.log", "w"),
               stderr=stdout)

# Close original file descriptors
close(old_stdin)
close(old_stdout)
close(old_stderr)

# Create new session
ccall(:setsid, Cint, ())

# Timer loop
using Dates
t = time()
while time() < t + 10
    println("timer running, $(time() - t) seconds")
    sleep(1)
end
