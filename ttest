function runwithopts(func, minargs, maxargs)
    @assert minargs <= length(ARGS) <= maxargs "Wrong number of arguments"
    debug, infile, outfile = false, "", ""
    for arg in ARGS
        if arg == "-d" || arg == "-debug" 
            debug = true
        elseif isempty(infile)
            infile = arg
        elseif isempty(outfile)
            outfile = arg
        end
    end
    ioin = isempty(infile) ? stdin : open(infile, "r")
    ioout = isempty(outfile) ? stdout : open(outfile, "w")
    func(ioin, ioout, debug)
end

runwithopts(preprocess, 1, 3)
