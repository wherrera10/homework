# preprocess.jl convert includes to file contenets

length(ARGS) < 2 && error("Usage: $PROGRAM_FiLE <infile> <outfile>")

function includefile(s)
    try
        m = match(r"(\s)include\"([^\"]+)\"(\s)", s)
        incl = read(m.captures[2], String)
        return m.captures[1] * incl * m.captures[3]
    catch y
        warn(y)
        return s
    end
end

input = read(ARGS[1], String)

output = replace(input, r"\sinclude\"[^\"]+\"\s)" => includefile(x))

write(ARGS[2], output)

