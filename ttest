total_weight(s) = (n = nodes[s];  n.weight + (isempty(n.children) ? 0 : sum(total_weight, n.children))

