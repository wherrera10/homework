using Distributed

@everywhere function daemonize(outfile = "test3_demonize.log")
    try
        # Redirect standard I/O
        redirect_stdio(; stdin = devnull,
            stdout = open(outfile, "w"),
            stderr = devnull)

        first_t = time()
        # write logs
        while time() < first_t + 10
            println("timer running, $(time() - first_t) seconds")
            sleep(1)
        end
    catch e
        println("Error occurred: $e")
    finally
        close(stdout)
    end
end

addprocs(3)

@spawnat 3 daemonize()

sleep(12)
